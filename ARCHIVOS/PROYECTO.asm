.MODEL SMALL

.STACK 100H

.DATA

ABRIRLEER MACRO HANDLE, FILENAME
	MOV AH, 3DH
  	MOV AL, 00H
  	LEA DX, FILENAME
  	INT 21H
  	MOV HANDLE, AX
ENDM

ABRIRESCRI MACRO HANDLE, FILENAME
	MOV AH, 3DH
  	MOV AL, 01H
  	LEA DX, FILENAME
  	INT 21H
  	MOV HANDLE, AX
ENDM

LEERCHAR MACRO HANDLE, BUFFER
	MOV AH, 3FH
	MOV BX, HANDLE
	MOV CX, 1H
	LEA DX, BUFFER
	INT 21H
ENDM

CERRARARCH MACRO HANDLE
	MOV AH, 3EH
	MOV BX, HANDLE
	INT 21H
ENDM

ESCRCHAR MACRO HANDLE, BUFFER
	MOV AH, 40H
	MOV BX, HANDLE
	MOV CX, 1H
	LEA DX, BUFFER
	INT 21H
ENDM

MOVERARCH MACRO HANDLE, POS
	MOV AH, 42H
	MOV AL, 0
	MOV BX, HANDLE
	MOV CX, 0
	MOV DX, POS
	INT 21H
ENDM

VIDEO MACRO
	MOV AH, 00H
	MOV AL, 12H 
	INT 10H
ENDM

PIXEL MACRO X, Y, COLOR
	MOV CX, X
	MOV DX, Y
	MOV AL, COLOR
	MOV AH, 0CH
	INT 10H
ENDM

REC_CUAD MACRO X1,Y1,X2,Y2,COL
    MOV BX, X1 
    MOV CX, X1 
    MOV DX, Y1
CICLO2:
    MOV AH, 0CH 
    MOV AL, COL
    INT 10H
    INC CX
    CMP CX, X2
    JNE CICLO2
    MOV CX, X1
	
    INC DX
    CMP DX, Y2
    JNE CICLO2
ENDM

POS_CURSOR MACRO FIL, COL      
	MOV AH, 02H
	MOV BH, 00H
	MOV DH, FIL
	MOV DL, COL
	INT 10H
ENDM

TXTS MACRO TXT, POX1, CONT1, COLT
	XOR BX, BX
	LEA SI, TXT
	MOV COLORT, COLT
	MOV CONT, CONT1	
	MOV POX, POX1
	CALL IMPRIMIR_CONF
ENDM

TEXTOS2 MACRO TEXT
	MOV ah, 02h
	INT 10h
	MOV al, TEXT
	MOV bh, 0
	MOV cx, 1
	MOV bl,  COLORT
	MOV ah, 09h
	INT 10h
ENDM

COUT MACRO CADENA
	MOV AH, 09H
	MOV DX, OFFSET CADENA
	INT 21H
ENDM

ELIMIN MACRO HANDLE
	MOV AH, 41H
	LEA DX, HANDLE
	INT 21H
ENDM

CREAR MACRO HANDLE
	MOV AH, 5BH
	XOR CX, CX
	LEA DX, HANDLE
	INT 21H
ENDM

LIMPARCH MACRO HANDLE, FILENAME
	ABRIRESCRI HANDLE, FILENAME
	MOV AH, 40H
	MOV BX, HANDLE
	MOV CX, 0H
	INT 21H
	CERRARARCH HANDLE
ENDM


BUFF	db  26
		db  ?
		db  26 dup(0)
LONG DB 20
LONGR DB ?
CADENA DB 20 DUP('0')

CONT DB 0
POSX DW 9D
ANCH DB 30
EXIT DB 0
VALI DW 0
POX DB ?
COLORT DB ?
BOOL_ESP_V DB 0
BOOL_ESP_H DB 0
BOOL_MOUSEPRESSED DB 0
VAR_INVCOL DB 0
BOOL_RTIZQ DB 0
BOOL_RTDER DB 0
BOOL_INVCOL DB 0
BOOL_V_IMG DB 0
BOOL_GUARDAR DB 0
MSJ_INI DB 0dh,' BIENDVENIDO ', '$'
SALISTE DB 0dh,'HAS SALIDO DEL PROGRAMA' , '$'

MSG1 DB 'INGRESE EL NOMBRE DEL ARCH: ','$'
BTN_SALIR DB 'SALIR','$'
BTN_ROTDERECHA DB 'ROTAR DER','$'
BTN_ROTIZQUIERDA DB 'ROTAR IZQ','$'
BTN_CARGARIMG DB 'CARGAR IMG','$'
BTN_INVRCOL DB 'INVRT COL','$'
BTN_ESP_V DB 'ESP VER','$'
BTN_ESP_H DB 'ESP HOR','$'
BTN_GUARDAR DB 'GUARDAR','$'
FILENAME DB 26 DUP (0)
HANDLE1 DW ?
BUFFER DB 0H

TEMP1 DB 'C:\IMAGENES\TEMP1.IER', 0
TEMP2 DB 'C:\IMAGENES\TEMP2.IER', 0
HANDLE2 DW ?
FILAS DW 0
COLUMNAS DW 0
COLOR DB ?
X DW 0
Y DW 0
TOTAL DW 0
PCOL DW ?
AUX DW ?
.CODE

MAIN PROC FAR
	MOV AX, @DATA
	MOV DS, AX
	
	COUT MSJ_INI
	
	CALL INICIAR_VIDEO
	
	TXTS MSG1 10, 10, 89H
	
	POS_CURSOR 10, 40
	
	MOV AH, 0AH
	LEA DX, BUFF
	INT 21H                
	
	MOV SI, OFFSET BUFF + 1
	MOV CL, [ SI ]
	MOV CH, 0    
	INC CX
	ADD SI, CX 
	MOV AL, '$'
	MOV [ SI ], AL 
	
	
	LEA SI, BUFF
	LEA DI, FILENAME
	CALL CORREGIR
	
	CALL COPIARARCH
	MOV AH, 01H 
	INT 16H
	
	
	CALL ACTIVAR_MOUSE
	CALL PINTAR_BOTONES
	CALL CLS_PANT
	
BUCLE:
	CALL GETPOS_MOUSE
	CMP EXIT, 1
	JE EXIT2
	CMP BOOL_V_IMG, 1
	JE MOSTRAR_IMAGEN
	CMP BOOL_RTDER, 1
	JE MOSTRAR_ROT_DER
	CMP BOOL_INVCOL, 1
	JE MOSTRAR_INV_COL
	CMP BOOL_RTIZQ, 1
	JE MOSTRAR_ROT_IZQ
	CMP BOOL_ESP_V, 1
	JE MOSTRAR_ESP_V
	CMP BOOL_ESP_H, 1
	JE MOSTRAR_ESP_H
	CMP BOOL_GUARDAR, 1
	JE  GUARDAR
	JMP BUCLE
EXIT2:
	CALL LIMPIAR_PANT
	MOV AH, 01H
	INT 16H 
	COUT SALISTE
	MOV AX, 4C02H
	INT 21H
MOSTRAR_IMAGEN:
	CALL CLS_PANT
	CALL MOSTRARIMG
	MOV BOOL_V_IMG, 0
	JMP BUCLE
MOSTRAR_ROT_DER:
	CALL CLS_PANT
	CALL ROTDER
	CALL MOSTRARIMG
	MOV BOOL_RTDER, 0
	JMP BUCLE
MOSTRAR_INV_COL:
	MOV BOOL_INVCOL, 0
	CALL CLS_PANT
	CALL INVERTCOLOR
	CALL MOSTRARIMG
	
	JMP BUCLE
MOSTRAR_ROT_IZQ:
	CALL CLS_PANT
	CALL ROTIZQ
	CALL MOSTRARIMG
	MOV BOOL_RTIZQ, 0
	JMP BUCLE
MOSTRAR_ESP_V:
	CALL CLS_PANT
	CALL REFLEANCH
	CALL MOSTRARIMG
	MOV BOOL_ESP_V, 0
	JMP BUCLE
MOSTRAR_ESP_H:
	CALL CLS_PANT
	CALL REFLEALT
	CALL MOSTRARIMG
	MOV BOOL_ESP_H, 0
	JMP BUCLE
GUARDAR:
	MOV BOOL_GUARDAR, 0
	CALL GUARDARARCH
	JMP BUCLE

	MOV AX, 4C02H
	INT 21H
MAIN ENDP

CORREGIR PROC
CINI:
	MOV AL, [SI]
	CMP AL, 24H
	JE CFIN
	
	CMP AL, 21H
	JNB CPR
	
	JMP COTRO
CPR:
	CMP AL, 7EH
	JBE CSEG
	JMP COTRO
CSEG:
	MOV [DI], AL
	INC DI
	JMP COTRO
COTRO:
	INC SI
	JMP CINI
CFIN:
	RET
CORREGIR ENDP

IMPRIMIR_CONF PROC
	MOV AL, [SI]
	INC SI
	CMP AL, 24H
	JE FINI
	
	INC CONT
	POS_CURSOR POX,CONT
	TEXTOS2 AL
	CALL IMPRIMIR_CONF
FINI:
	RET
IMPRIMIR_CONF ENDP

LIMPIAR_PANT PROC
	MOV AX, 0600H
	MOV BH, 17H
	MOV CX, 0000H
	MOV DX, 184FH
	INT 10H
	RET
LIMPIAR_PANT ENDP

MOUSE_RELEASED PROC 
	MOV AX, 6H
	INT 33H
RESETEAR:
	CMP CX, 460D
	JGE RESET_INVCOL
	XOR BX, BX
	CMP CX, 370D
	JGE RESET_RD
	XOR BX, BX
	CMP CX, 280D
	JGE RESET_BCIM
	XOR BX, BX
	CMP CX, 190D
	JGE RESET_RI
	XOR BX, BX
	CMP CX, 100D
	JGE RESET_H
	XOR BX, BX
	CMP CX, 20D
	JGE RESET_V
	XOR BX, BX
	JMP FINRESET

RESET_V:
    CMP CX, 90D
    JLE RESET_V2
    XOR BX,BX
    JMP FINRESET		
RESET_H:
    CMP CX,180D
    JLE RESET_H2
    XOR BX,BX
    JMP FINRESET		
RESET_INVCOL:
	CMP CX,540D
    JLE RESET_INVCOL2
    XOR BX,BX
    JMP FINRESET	
RESET_BCIM:
	CMP CX,360D
    JLE RESET_BCIM2
    XOR BX,BX
    JMP FINRESET
RESET_INVCOL2:	
	CMP DX, 09D
    JG RESET_INVCOL3
	XOR BX,BX
    JMP FINRESET
RESET_RD:	
	CMP CX, 450D
    JLE RESET_RD2
    XOR BX,BX
    JMP FINRESET
RESET_RI:
	CMP CX, 270D
    JLE RESET_RI2
    XOR BX,BX
    JMP FINRESET
RESET_H2:
	CMP DX, 09D
    JG RESET_H3
    XOR BX,BX
    JMP FINRESET
RESET_V2:
	CMP DX, 09D
    JG RESET_V3
    XOR BX,BX
    JMP FINRESET
RESET_BCIM2:
    CMP DX, 09D
    JG RESET_BCIM3
    XOR BX,BX
    JMP FINRESET
RESET_INVCOL3:
    CMP DX, 35D
    JLE RESET_INVCOL4
    XOR BX,BX
    JMP FINRESET
RESET_RD2:
	CMP DX, 09D
    JG RESET_RD3
    XOR BX,BX
    JMP FINRESET
RESET_RI2:
    CMP DX, 09D
    JG RESET_RI3
    XOR BX,BX
    JMP FINRESET
RESET_V3:
	CMP DX, 35D
    JLE RESET_V4
    XOR BX,BX
    JMP FINRESET
RESET_H3:
	CMP DX, 35D
    JLE RESET_H4
    XOR BX,BX
    JMP FINRESET
RESET_BCIM3:
    CMP DX, 35D
    JLE RESET_BCIM4
    XOR BX,BX
    JMP FINRESET
RESET_RI3:
	CMP DX, 35D
    JLE RESET_RI4
    XOR BX,BX
    JMP FINRESET
RESET_RD3:
    CMP DX, 35D
    JLE RESET_RD4
    XOR BX,BX
    JMP FINRESET	
RESET_BCIM4:
	MOV BOOL_V_IMG, 0
	JMP FINRESET
RESET_RD4:
	MOV BOOL_RTDER, 0
	JMP FINRESET
RESET_INVCOL4:
	MOV BOOL_INVCOL, 0
	JMP FINRESET
RESET_RI4:
	MOV BOOL_RTIZQ, 0
	JMP FINRESET
RESET_H4:
	MOV BOOL_ESP_H, 0
	JMP FINRESET
RESET_V4:
	MOV BOOL_ESP_V, 0
	JMP FINRESET
FINRESET:
	XOR BX, BX
	MOV BOOL_MOUSEPRESSED, 0
	RET
MOUSE_RELEASED ENDP

GETPOS_MOUSE PROC
	MOV AX, 05H
	INT 33H
VALIDAR:
	CMP DX, 45D
    JGE B_GUARDAR
	XOR BX, BX
	
	CMP CX, 550D
    JGE B_SALIR
	XOR BX, BX
	
	CMP CX, 460D
	JGE B_INV_COL
	XOR BX, BX
	CMP CX, 370D
	JGE ROT_DER
	XOR BX, BX
	CMP CX, 280D
	JGE BCARGAR_IMG
	XOR BX, BX
	CMP CX, 190D
	JGE ROT_IZQ
	XOR BX, BX
	CMP CX, 100D
	JGE ESP_H
	XOR BX, BX
	CMP CX, 20D
	JGE ESP_V
	XOR BX, BX
	
	
    JMP FINCOM
B_GUARDAR:
	CMP DX, 65D
    JLE B_GUARDAR2
    XOR BX,BX
    JMP FINCOM
ESP_V:
    CMP CX, 90D
    JLE ESP_V2
    XOR BX,BX
    JMP FINCOM		
ESP_H:
    CMP CX,180D
    JLE ESP_H2
    XOR BX,BX
    JMP FINCOM	
BCARGAR_IMG:
    CMP CX,360D
    JLE BCARGAR_IMG_2
    XOR BX,BX
    JMP FINCOM
B_INV_COL:
	CMP CX,540D
    JLE B_INV_COL_2
    XOR BX,BX
    JMP FINCOM
B_SALIR:
	CMP CX, 625D
    JLE B_SALIR_2
    XOR BX,BX
    JMP FINCOM
ROT_IZQ:	
	CMP CX, 270D
    JLE ROT_IZQ_2
    XOR BX,BX
    JMP FINCOM
ROT_DER:	
	CMP CX, 450D
    JLE ROT_DER_2
    XOR BX,BX
    JMP FINCOM

B_GUARDAR2:
	CMP CX, 550D
	JGE B_GUARDAR3
	XOR BX, BX
BCARGAR_IMG_2:
    CMP DX, 09D
    JG BCARGAR_IMG_3
    XOR BX,BX
    JMP FINCOM
B_INV_COL_2:
	CMP DX, 09D
    JG B_INV_COL_3
	XOR BX,BX
    JMP FINCOM
B_SALIR_2:
	CMP DX, 09D
    JGE B_SALIR_3
    XOR BX,BX
    JMP FINCOM
ESP_H2:
	CMP DX, 09D
    JG ESP_H3
    XOR BX,BX
    JMP FINCOM
ESP_V2:
	CMP DX, 09D
    JG ESP_V3
    XOR BX,BX
    JMP FINCOM
ROT_IZQ_2:	
	CMP DX, 09D
    JG ROT_IZQ_3
    XOR BX,BX
    JMP FINCOM
ROT_DER_2:
	CMP DX, 09D
    JG ROT_DER_3
    XOR BX,BX
    JMP FINCOM
B_GUARDAR3:
	CMP CX, 625D
    JLE B_GUARDAR4
    XOR BX,BX
    JMP FINCOM
B_SALIR_3:
	CMP DX, 35D
    JLE B_SALIR_4
    XOR BX,BX
    JMP FINCOM
BCARGAR_IMG_3:
    CMP DX, 35D
    JLE BCARGAR_IMG_4
    XOR BX,BX
    JMP FINCOM
B_INV_COL_3:
    CMP DX, 35D
    JLE B_INV_COL_4
    XOR BX,BX
    JMP FINCOM
ROT_IZQ_3:
    CMP DX, 35D
    JLE ROT_IZQ_4
    XOR BX,BX
    JMP FINCOM
ROT_DER_3:
    CMP DX, 35D
    JLE ROT_DER_4
    XOR BX,BX
    JMP FINCOM		

ESP_H3:
	CMP DX, 35D
    JLE ESP_H4
    XOR BX,BX
    JMP FINCOM
ESP_V3:
	CMP DX, 35D
    JLE ESP_V4
    XOR BX,BX
    JMP FINCOM
B_GUARDAR4:
	MOV BOOL_GUARDAR, 1
	JMP FINCOM
BCARGAR_IMG_4:
	MOV BOOL_V_IMG, 1
	JMP FINCOM
B_INV_COL_4:
	MOV BOOL_INVCOL, 1
	JMP FINCOM
B_SALIR_4:
	MOV EXIT, 1
	JMP FINCOM
ESP_H4:
	MOV BOOL_ESP_H, 1
	JMP FINCOM
ESP_V4:
	MOV BOOL_ESP_V, 1
	JMP FINCOM
ROT_IZQ_4:
	MOV BOOL_RTIZQ, 1
	JMP FINCOM
ROT_DER_4:
	MOV BOOL_RTDER, 1
	JMP FINCOM
CLS_MOUSE:
	XOR BX, BX
    MOV VALI, 0
	RET
FINCOM:
	CALL MOUSE_RELEASED
	XOR BX, BX
	MOV BOOL_MOUSEPRESSED, 1
    MOV VALI, 0
	RET
GETPOS_MOUSE ENDP

CLS_POS_MOUSE PROC
	MOV CX, 100D
	MOV DX, 200D
	XOR BX, BX
	INT 33H
	RET
CLS_POS_MOUSE ENDP

PINTAR_BOTONES PROC

;*****************************************
;**************** BOTONES ****************
;*****************************************
	MOV CX, 20D 
    MOV DX, POSX
BTN_6:
    MOV AH, 0CH
    MOV AL, 3D
    INT 10H
    INC CX
    CMP CX, 90D
    JNE BTN_6
    MOV CX, 20D
	
    INC DX
    CMP DX, 35
    JNE BTN_6

    MOV CX, 100D 
    MOV DX, POSX
BTN_1:
    MOV AH, 0CH 
    MOV AL, 5D
    INT 10H
    INC CX
    CMP CX, 180D
    JNE BTN_1
    MOV CX, 100D
	
    INC DX
	
    CMP DX, 35
    JNE BTN_1
	
	MOV CX, 190D
    MOV DX, POSX
BTN_2:
    MOV AH, 0CH 
    MOV AL, 66D
    INT 10H
    INC CX
    CMP CX, 270D
    JNE BTN_2
    MOV CX, 190D
	
    INC DX
    CMP DX, 35
    JNE BTN_2
	
	MOV CX, 280D 
    MOV DX, POSX
BTN_3:
    MOV AH, 0CH 
    MOV AL, 30D
    INT 10H
    INC CX
    CMP CX, 360D
    JNE BTN_3
    MOV CX, 280D
	
    INC DX
    CMP DX, 35
    JNE BTN_3

	
	MOV CX, 370D
    MOV DX, POSX
BTN_4:
    MOV AH, 0CH
    MOV AL, 7D
    INT 10H
    INC CX
    CMP CX, 450D
    JNE BTN_4
    MOV CX, 370D
	
    INC DX
    CMP DX, 35
    JNE BTN_4

	MOV CX, 460D 
    MOV DX, POSX
BTN_5:
    MOV AH, 0CH 
    MOV AL, 10D
    INT 10H
    INC CX
    CMP CX, 540D
    JNE BTN_5
    MOV CX, 460D
	
    INC DX
    CMP DX, 35
    JNE BTN_5
	
	MOV CX, 550D 
    MOV DX, POSX
BTN_7:
    MOV AH, 0CH 
    MOV AL, 4D
    INT 10H
    INC CX
    CMP CX, 625D
    JNE BTN_7
    MOV CX, 550D
	
    INC DX
    CMP DX, 35D
    JNE BTN_7
	
	MOV CX, 550D 
    MOV DX, 40D
BTN_8:
    MOV AH, 0CH 
    MOV AL, 9D
    INT 10H
    INC CX
    CMP CX, 625D
    JNE BTN_8
    MOV CX, 550D
	
    INC DX
    CMP DX, 65D
    JNE BTN_8
	
;*****************************************
;**************** BOTONES ****************
;*****************************************
	
	
	
;*****************************************
;************** TXT BOTONES **************
;*****************************************
	
	TXTS BTN_ESP_H 1, 92, 89H
	TXTS BTN_ROTIZQUIERDA 1, 103, 89H
	TXTS BTN_CARGARIMG 1, 114, 89H
	TXTS BTN_ROTDERECHA 1, 126, 89H
	TXTS BTN_INVRCOL 1, 137, 89H
	TXTS BTN_SALIR 1, 149, 89H
	TXTS BTN_ESP_V 1, 82, 89H
	TXTS BTN_GUARDAR 3, 149, 89H
;*****************************************
;************** TXT BOTONES **************
;*****************************************
	
	RET
PINTAR_BOTONES ENDP

INICIAR_VIDEO PROC
	MOV AH, 00H ;INGRESO A MODO DE VIDEO
	MOV AL, 12H 
	INT 10H

	RET
INICIAR_VIDEO ENDP

ACTIVAR_MOUSE PROC
	MOV AX,00H
	INT 33H	
	MOV AX,01H
	INT 33H
	RET
ACTIVAR_MOUSE ENDP

GUARDARARCH PROC
	LIMPARCH HANDLE1, FILENAME
	ABRIRLEER HANDLE1, TEMP1
	ABRIRESCRI HANDLE2, FILENAME
GAINI:
	LEERCHAR HANDLE1, BUFFER
	
	ESCRCHAR HANDLE2, BUFFER
	CMP BUFFER, 25H
	JE GAFIN
	
	JMP GAINI
GAFIN:
	CERRARARCH HANDLE1
	CERRARARCH HANDLE2
	RET
GUARDARARCH ENDP

CLS_PANT PROC
	MOV X, 50
	MOV Y, 50
	MOV COLOR, 0
CLSCOL:
	CMP X, 400
	JE CLSFIL
	
	PIXEL X, Y, COLOR

	INC X
	JMP CLSCOL
CLSFIL:
	CMP Y, 600
	JE CLSFIN
	MOV X, 50
	INC Y
	JMP CLSCOL
CLSFIN:
	RET
CLS_PANT ENDP

INIVAL PROC
	MOV X, 0
	MOV Y, 0
	MOV COLUMNAS, 0
	MOV FILAS, 0
	MOV TOTAL, 0
	ABRIRLEER HANDLE1, TEMP1
COL2:
	LEERCHAR HANDLE1, BUFFER
	CMP BUFFER, 25H
	
	JE FIN2
	INC TOTAL
	CMP BUFFER, 40H
	JE FIL2
	INC X
	JMP COL2
FIL2:
	MOV AX, X
	MOV COLUMNAS, AX
	MOV X, 0
	INC Y
	INC FILAS
	JMP COL2
FIN2:
	CERRARARCH HANDLE1
	RET
INIVAL ENDP

INVERTCOLOR PROC
	
	LIMPARCH HANDLE1, TEMP2
	ABRIRLEER HANDLE1, TEMP1
	ABRIRESCRI HANDLE2, TEMP2
	
ICINI:
	LEERCHAR HANDLE1, BUFFER
	MOV AL, BUFFER
	MOV COLOR, AL
	CALL INVCOLOR
	ESCRCHAR HANDLE2, COLOR
	CMP BUFFER, 25H
	JE ICFIN

	JMP ICINI
ICFIN:
	CERRARARCH HANDLE1
	CERRARARCH HANDLE2
	CALL COPIARARCH2
	RET
INVERTCOLOR ENDP

REFLEALT PROC
	CALL INIVAL
	MOV X, 1
	MOV Y, 1
	
	LIMPARCH HANDLE1, TEMP2
	ABRIRLEER HANDLE1, TEMP1
	ABRIRESCRI HANDLE2, TEMP2
	
	INC COLUMNAS
	MOV AX, TOTAL
	SUB AX, COLUMNAS
	DEC COLUMNAS
	MOV PCOL, AX
COL5:
	MOV AX, Y
	CMP AX, 1
	JE EA5
EX5:
	MOVERARCH HANDLE1, PCOL
	
	LEERCHAR HANDLE1, BUFFER
	
	ESCRCHAR HANDLE2, BUFFER
	
	INC PCOL

	MOV AX, Y
	CMP AX, COLUMNAS
	JE FIL5
	
	INC Y
	JMP COL5
EA5:
	JMP EY5
FIL5:
	MOV Y, 1
	MOV AX, X
	CMP AX, FILAS
	JE FIN5
	
	INC COLUMNAS
	MOV AX, AUX
	SUB AX, COLUMNAS
	MOV PCOL, AX
	DEC COLUMNAS

	MOV BUFFER, 40H
	ESCRCHAR HANDLE2, BUFFER
	
	INC X
	JMP COL5
EY5:
	MOV AX, PCOL
	MOV AUX, AX
	JMP EX5
FIN5:
	MOV BUFFER, 40H
	ESCRCHAR HANDLE2, BUFFER
	
	MOV BUFFER, 25H
	ESCRCHAR HANDLE2, BUFFER
	
	CERRARARCH HANDLE1
	
	CERRARARCH HANDLE2
	CALL COPIARARCH2
	RET
REFLEALT ENDP

REFLEANCH PROC

	CALL INIVAL
	MOV X, 1
	MOV Y, 1
	
	LIMPARCH HANDLE1, TEMP2
	ABRIRLEER HANDLE1, TEMP1
	ABRIRESCRI HANDLE2, TEMP2
	
	DEC COLUMNAS
	MOV AX, COLUMNAS
	MOV PCOL, AX
	INC COLUMNAS
COL6:
	MOV AX, Y
	CMP AX, 1
	JE EA6
EX6:
	MOVERARCH HANDLE1, PCOL
	
	LEERCHAR HANDLE1, BUFFER
	
	ESCRCHAR HANDLE2, BUFFER
	
	DEC PCOL
	
	MOV AX, Y
	CMP AX, COLUMNAS
	JE FIL6
	
	INC Y
	JMP COL6
EA6:
	JMP EY6
FIL6:
	MOV Y, 1
	MOV AX, X
	CMP AX, FILAS
	JE FIN6
	
	INC COLUMNAS
	MOV AX, AUX
	ADD AX, COLUMNAS
	MOV PCOL, AX
	DEC COLUMNAS

	MOV BUFFER, 40H
	ESCRCHAR HANDLE2, BUFFER
	
	INC X
	JMP COL6
EY6:
	MOV AX, PCOL
	MOV AUX, AX
	JMP EX6
FIN6:
	MOV BUFFER, 40H
	ESCRCHAR HANDLE2, BUFFER
	
	MOV BUFFER, 25H
	ESCRCHAR HANDLE2, BUFFER
	
	CERRARARCH HANDLE1
	
	CERRARARCH HANDLE2
	
	CALL COPIARARCH2
	
	RET
REFLEANCH ENDP

ROTDER PROC
	CALL INIVAL
	MOV X, 1
	MOV Y, 1
	
	LIMPARCH HANDLE1, TEMP2
	ABRIRLEER HANDLE1, TEMP1
	ABRIRESCRI HANDLE2, TEMP2
	
	INC COLUMNAS
	MOV AX, TOTAL
	SUB AX, COLUMNAS
	DEC COLUMNAS
	MOV PCOL, AX
COL:
	MOV AX, Y
	CMP AX, 1
	JE EA
EX:
	MOVERARCH HANDLE1, PCOL
	
	LEERCHAR HANDLE1, BUFFER
	
	ESCRCHAR HANDLE2, BUFFER
	
	INC COLUMNAS
	MOV AX, PCOL
	SUB AX, COLUMNAS
	DEC COLUMNAS
	MOV PCOL, AX

	MOV AX, Y
	CMP AX, FILAS
	JE FIL
	
	INC Y
	JMP COL
EA:
	JMP EY
FIL:
	MOV Y, 1
	MOV AX, X
	CMP AX, COLUMNAS
	JE FIN
	
	INC AUX
	MOV AX, AUX
	MOV PCOL, AX

	MOV BUFFER, 40H
	ESCRCHAR HANDLE2, BUFFER
	
	INC X
	JMP COL
EY:
	MOV AX, PCOL
	MOV AUX, AX
	JMP EX
FIN:
	MOV BUFFER, 40H
	ESCRCHAR HANDLE2, BUFFER
	
	MOV BUFFER, 25H
	ESCRCHAR HANDLE2, BUFFER
	
	CERRARARCH HANDLE1
	
	CERRARARCH HANDLE2
	CALL COPIARARCH2
	RET
ROTDER ENDP

ROTIZQ PROC
	
	CALL INIVAL
	MOV X, 1
	MOV Y, 1
	
	LIMPARCH HANDLE1, TEMP2
	ABRIRLEER HANDLE1, TEMP1
	ABRIRESCRI HANDLE2, TEMP2

	DEC COLUMNAS
	MOV AX, COLUMNAS
	MOV PCOL, AX
	INC COLUMNAS
	
COL3:
	MOV AX, Y
	CMP AX, 1
	JE EA3
EX3:
	MOVERARCH HANDLE1, PCOL
	
	LEERCHAR HANDLE1, BUFFER
	
	ESCRCHAR HANDLE2, BUFFER
	
	INC COLUMNAS
	MOV AX, PCOL
	ADD AX, COLUMNAS
	DEC COLUMNAS
	MOV PCOL, AX
	
	MOV AX, Y
	CMP AX, FILAS
	JE FIL3
	
	INC Y
	JMP COL3
EA3:
	JMP EY3
FIL3:
	MOV Y, 1
	MOV AX, X
	CMP AX, COLUMNAS
	JE FIN3
	
	DEC AUX
	MOV AX, AUX
	MOV PCOL, AX

	MOV BUFFER, 40H
	ESCRCHAR HANDLE2, BUFFER
	
	INC X
	JMP COL3
EY3:
	MOV AX, PCOL
	MOV AUX, AX
	JMP EX3

FIN3:
	MOV BUFFER, 40H
	ESCRCHAR HANDLE2, BUFFER
	
	MOV BUFFER, 25H
	ESCRCHAR HANDLE2, BUFFER
	
	CERRARARCH HANDLE1
	
	CERRARARCH HANDLE2
	
	CALL COPIARARCH2
	
	RET
	
ROTIZQ ENDP

COPIARARCH PROC
	LIMPARCH HANDLE1, TEMP1
	ABRIRLEER HANDLE1, FILENAME
	ABRIRESCRI HANDLE2, TEMP1
CAINI:
	LEERCHAR HANDLE1, BUFFER
	
	ESCRCHAR HANDLE2, BUFFER
	CMP BUFFER, 25H
	JE CAFIN
	
	JMP CAINI
CAFIN:
	CERRARARCH HANDLE1
	CERRARARCH HANDLE2
	RET
COPIARARCH ENDP

COPIARARCH2 PROC
	LIMPARCH HANDLE1, TEMP1
	ABRIRLEER HANDLE1, TEMP2
	ABRIRESCRI HANDLE2, TEMP1
CA2INI:
	LEERCHAR HANDLE1, BUFFER
	
	ESCRCHAR HANDLE2, BUFFER
	CMP BUFFER, 25H
	JE CA2FIN
	
	JMP CA2INI
CA2FIN:
	CERRARARCH HANDLE1
	CERRARARCH HANDLE2
	RET
COPIARARCH2 ENDP

MOSTRARIMG PROC
	MOV X, 100
	MOV Y, 100
	
	ABRIRLEER HANDLE2, TEMP1
COL4:
	LEERCHAR HANDLE2, BUFFER
	LEA SI, COLOR
	CMP [BUFFER], 25H
	JE FIN4
	CMP [BUFFER], 40H
	JE FIL4
	MOV AL, [BUFFER]
	MOV [SI], AL
	
	MOV CX, X
	MOV DX, Y
	CALL VCOLOR
	PIXEL X, Y, COLOR

	INC X
	JMP COL4
FIL4:
	MOV X, 100
	INC Y
	JMP COL4
FIN4:

	CERRARARCH HANDLE2
	RET
MOSTRARIMG ENDP

VCOLOR PROC
	CMP [BUFFER], 'A'
	JE VA
	CMP [BUFFER], 'B'
	JE VB
	CMP [BUFFER], 'C'
	JE VC
	CMP [BUFFER], 'D'
	JE VD
	CMP [BUFFER], 'E'
	JE VE
	CMP [BUFFER], 'F'
	JE VF
	
	RET
VA:
	MOV COLOR, 10
	RET
VB:
	MOV COLOR, 11
	RET
VC:
	MOV COLOR, 12
	RET
VD:
	MOV COLOR, 13
	RET
VE:
	MOV COLOR, 14
	RET
VF:
	MOV COLOR, 15
	RET
	
VCOLOR ENDP

INVCOLOR PROC
	CMP [BUFFER], 'A'
	JE IVA
	CMP [BUFFER], 'B'
	JE IVB
	CMP [BUFFER], 'C'
	JE IVC
	CMP [BUFFER], 'D'
	JE IVD
	CMP [BUFFER], 'E'
	JE IVE
	CMP [BUFFER], 'F'
	JE IVF
	CMP [BUFFER], '9'
	JE IV9
	CMP [BUFFER], '8'
	JE IV8
	CMP [BUFFER], '7'
	JE IV7
	CMP [BUFFER], '6'
	JE IV6
	CMP [BUFFER], '5'
	JE IV5
	CMP [BUFFER], '4'
	JE IV4
	CMP [BUFFER], '3'
	JE IV3
	CMP [BUFFER], '2'
	JE IV2
	CMP [BUFFER], '1'
	JE IV1
	CMP [BUFFER], '0'
	JE IV0
	
	RET
IVA:
	MOV COLOR, '5'
	RET
IVB:
	MOV COLOR, '4'
	RET
IVC:
	MOV COLOR, '3'
	RET
IVD:
	MOV COLOR, '2'
	RET
IVE:
	MOV COLOR, '1'
	RET
IVF:
	MOV COLOR, '0'
	RET
IV9:
	MOV COLOR, '6'
	RET
IV8:
	MOV COLOR, '7'
	RET
IV7:
	MOV COLOR, '8'
	RET
IV6:
	MOV COLOR, '9'
	RET
IV5:
	MOV COLOR, 'A'
	RET
IV4:
	MOV COLOR, 'B'
	RET
IV3:
	MOV COLOR, 'C'
	RET
IV2:
	MOV COLOR, 'D'
	RET
IV1:
	MOV COLOR, 'E'
	RET
IV0:
	MOV COLOR, 'F'
	RET

INVCOLOR ENDP

END